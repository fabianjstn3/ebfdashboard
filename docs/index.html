<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Breastfeeding Dashboard</title>
    <link rel="icon" type="image/x-icon" href="milk.svg">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

   <div id="loader-wrapper">
    <div class="intro-scene">
        <img src="milk.svg" class="falling-milk" alt="milk">
        <div class="smoke-ring"></div>
        <div class="splash-wipe"></div>
    </div>

    <div class="precision-loader delayed-show">
        <div class="orbit-ring ring-1"></div>
        <div class="orbit-ring ring-2"></div>
        <div class="core-dot"></div>
        <div class="loader-text-minimal">SYSTEM ONLINE</div>
        </div>
    </div>

    <div class="dashboard-wrapper">
        
        <header class="kpi-bar">
            <div class="mobile-toggle-wrapper">
                <label class="switch">
                    <input type="checkbox" id="darkModeToggleMobile">
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="kpi-card">
                <span class="kpi-label">National EBF Rate</span>
                <div class="kpi-value-row">
                    <span class="kpi-number" id="kpi-national">--%</span>
                    <span class="trend-arrow" id="kpi-national-trend">--</span>
                </div>
                <span class="kpi-sub">Target: 70%</span>
            </div>
            <div class="kpi-card">
                <span class="kpi-label">Selected Region</span>
                <div class="kpi-value-row">
                    <span class="kpi-number" id="kpi-region-val">--%</span>
                    <span class="trend-arrow" id="kpi-region-trend"></span>
                </div>
                <span class="kpi-sub" id="kpi-region-name">Region</span>
            </div>
            <div class="header-title">
                <h1>ü§± EBF Adherence Monitor </h1>
                <p>Exclusive Breastfeeding Surveillance</p>
            </div>
        </header>

        <div class="main-content">
            
            <aside class="sidebar">
                <div class="mode-toggle-container">
                    <label class="switch">
                        <input type="checkbox" id="darkModeToggle">
                        <span class="slider round"></span>
                    </label>
                    <span class="mode-label">Dark Mode</span>
                </div>
            
                <div class="filter-section">
                    <h3>üîç Filters</h3>
                    <div class="filter-group">
                        <label>Survey Year</label>
                        <select id="yearFilter" class="control-input">
                        </select>
                    </div>
                    
                    <button id="heatmapBtn" class="download-btn" style="background-color: var(--accent); margin-top: 10px;">
                        üìÖ Yearly Matrix
                    </button>
                    
                    <button id="downloadBtn" class="download-btn">‚¨áÔ∏è Export CSV</button>
                </div>
                <div class="info-card">
                    <h2 id="region-name">Click/Hover on a Region</h2>
                    <div class="stat-box">
                        <span class="value" id="region-rate">--%</span>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item"><span class="dot high"></span> > 50%</div>
                    <div class="legend-item"><span class="dot med"></span> 30%-40%</div>
                    <div class="legend-item"><span class="dot low"></span> < 30%</div>
                </div>
            </aside>

            <section class="map-wrapper">
                <div id="chartdiv"></div>
            </section>

            <section class="charts-panel">
                <div class="chart-box">
                    <div class="chart-header-row">
                        <h3 id="line-chart-header">üìà Historical Trend</h3>
                        <button class="chart-info-btn" data-chart="line" title="How to read this chart">i</button>
                    </div>
                    <div id="linechartdiv">
                        <canvas id="lineChartCanvas"></canvas>
                    </div>
                </div>

                <div class="chart-box">
                    <div class="chart-header-row">
                        <h3>‚ö° Demographic Profile</h3> 
                        <button class="chart-info-btn" data-chart="radar" title="How to read this chart">i</button>
                    </div>
                    <div style="position: relative; height: 300px;">
                        <canvas id="demographicChartCanvas"></canvas>
                    </div>
                    <p class="pie-note" style="text-align:center; margin-top:5px;">Urban vs Rural | Male vs Female</p>
                </div>

                <div class="chart-box">
                    <div class="chart-header-row">
                        <h3>üìâ Age Drop-off</h3>
                        <button class="chart-info-btn" data-chart="scatter" title="How to read this chart">i</button>
                    </div>
                    <div style="position: relative; height: 300px;">
                        <canvas id="scatterChartCanvas"></canvas>
                    </div>
                    <p class="pie-note" style="text-align:center; margin-top:5px;">EBF adherence by infant age (0-5 months).</p>
                </div>
                
                <div class="chart-box">
                    <div class="chart-header-row">
                        <h3 id="pie-chart-header">üí∞ Wealth Distribution</h3>
                        <button class="chart-info-btn" data-chart="pie" title="How to read this chart">i</button>
                    </div>
                    <div id="piechartdiv">
                        <canvas id="pieChartCanvas"></canvas>
                    </div>
                    <div class="pie-legend">
                        <p class="pie-note">Breakdown by wealth quintile.</p>

                    <footer class="dashboard-footer">
            <p>
                Data Sources: 
                <a href="https://dhsprogram.com/data/dataset/Philippines_Standard-DHS_2017.cfm?flag=1" target="_blank" rel="noopener noreferrer">PH 2017</a> 
                &bull; 
                <a href="https://dhsprogram.com/data/dataset/Philippines_Standard-DHS_2022.cfm?flag=1" target="_blank" rel="noopener noreferrer">PH 2022</a>
            </p>
            <p class="footer-credit">Demographic and Health Surveys (DHS) Program</p>
        </footer>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <button id="infoBtn" class="info-btn" title="About this Dashboard">
         <svg width="24" height="24" viewBox="0 0 1920 1920" fill="#2c3e50" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M960 0c530.193 0 960 429.807 960 960s-429.807 960-960 960S0 1490.193 0 960 429.807 0 960 0Zm0 101.053c-474.384 0-858.947 384.563-858.947 858.947S485.616 1818.947 960 1818.947 1818.947 1434.384 1818.947 960 1434.384 101.053 960 101.053Zm-42.074 626.795c-85.075 39.632-157.432 107.975-229.844 207.898-10.327 14.249-10.744 22.907-.135 30.565 7.458 5.384 11.792 3.662 22.656-7.928 1.453-1.562 1.453-1.562 2.94-3.174 9.391-10.17 16.956-18.8 33.115-37.565 53.392-62.005 79.472-87.526 120.003-110.867 35.075-20.198 65.9 9.485 60.03 47.471-1.647 10.664-4.483 18.534-11.791 35.432-2.907 6.722-4.133 9.646-5.496 13.23-13.173 34.63-24.269 63.518-47.519 123.85l-1.112 2.886c-7.03 18.242-7.03 18.242-14.053 36.48-30.45 79.138-48.927 127.666-67.991 178.988l-1.118 3.008a10180.575 10180.575 0 0 0-10.189 27.469c-21.844 59.238-34.337 97.729-43.838 138.668-1.484 6.37-1.484 6.37-2.988 12.845-5.353 23.158-8.218 38.081-9.82 53.42-2.77 26.522-.543 48.24 7.792 66.493 9.432 20.655 29.697 35.43 52.819 38.786 38.518 5.592 75.683 5.194 107.515-2.048 17.914-4.073 35.638-9.405 53.03-15.942 50.352-18.932 98.861-48.472 145.846-87.52 41.11-34.26 80.008-76 120.788-127.872 3.555-4.492 3.555-4.492 7.098-8.976 12.318-15.707 18.352-25.908 20.605-36.683 2.45-11.698-7.439-23.554-15.343-19.587-3.907 1.96-7.993 6.018-14.22 13.872-4.454 5.715-6.875 8.77-9.298 11.514-9.671 10.95-19.883 22.157-30.947 33.998-18.241 19.513-36.775 38.608-63.656 65.789-13.69 13.844-30.908 25.947-49.42 35.046-29.63 14.559-56.358-3.792-53.148-36.635 2.118-21.681 7.37-44.096 15.224-65.767 17.156-47.367 31.183-85.659 62.216-170.048 13.459-36.6 19.27-52.41 26.528-72.201 21.518-58.652 38.696-105.868 55.04-151.425 20.19-56.275 31.596-98.224 36.877-141.543 3.987-32.673-5.103-63.922-25.834-85.405-22.986-23.816-55.68-34.787-96.399-34.305-45.053.535-97.607 15.256-145.963 37.783Zm308.381-388.422c-80.963-31.5-178.114 22.616-194.382 108.33-11.795 62.124 11.412 115.76 58.78 138.225 93.898 44.531 206.587-26.823 206.592-130.826.005-57.855-24.705-97.718-70.99-115.729Z"/>
        </svg>
    </button>
    
    <div id="infoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Dashboard Context</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="context-item">
                    <strong>Data Source</strong>
                    <p>Based on the Expanded National Nutrition Survey (ENNS) conducted by the DOST-FNRI.</p>
                </div>
                <div class="context-item">
                    <strong>The 70% Target</strong>
                    <p>The dashed red line represents the 2030 Global Nutrition Target for exclusive breastfeeding.</p>
                </div>
                <div class="context-footer">
                    Definition: <em>Exclusive Breastfeeding (EBF)</em> refers to the proportion of infants 0‚Äì5.9 months receiving only breastmilk.
                </div>
            </div>
        </div>
    </div>

    <button id="leaderboardBtn" class="info-btn leaderboard-trigger" title="View Regional Rankings">
         <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
            <path d="M4 22h16"></path>
            <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
        </svg>
    </button>
    
    <div id="leaderboardModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px; width: 95%;">
            <div class="modal-header">
                <h2>üèÜ Regional Rankings</h2>
                <div style="display:flex; align-items:center; gap:15px;">
                    <button class="chart-info-btn white-btn" data-chart="bar" title="How to read this chart">i</button>
                    <span class="close-modal close-leaderboard">&times;</span>
                </div>
            </div>
            <div class="modal-body">
                <div style="height: 500px; position: relative;">
                    <canvas id="barChartCanvas"></canvas>
                </div>
                <button id="downloadRankingsBtn" class="download-btn">
                    ‚¨áÔ∏è View Full Rankings CSV
                </button>
                <div class="context-footer">
                    Rankings based on <span id="leaderboard-year">--</span> EBF Adherence Rates.
                </div>
            </div>
        </div>
    </div>

    <div id="heatmapModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 900px; width: 95%;">
            <div class="modal-header">
                <h2>üìÖ Year-over-Year Matrix</h2>
                <div style="display:flex; align-items:center; gap:15px;">
                    <button class="chart-info-btn white-btn" data-chart="heatmap" title="How to read this chart">i</button>
                    <span class="close-modal close-heatmap">&times;</span>
                </div>
            </div>
            <div class="modal-body">
                <div class="heatmap-container" style="overflow-x: auto;">
                    <table id="heatmapTable" class="heatmap-table">
                        </table>
                </div>
                <div class="legend" style="justify-content: center; margin-top: 10px;">
                    <div class="legend-item"><span class="dot high"></span>High (>50%)</div>
                    <div class="legend-item"><span class="dot med"></span>Med (30-50%)</div>
                    <div class="legend-item"><span class="dot low"></span>Low (<30%)</div>
                </div>
            </div>
        </div>
    </div>

    <div id="chartExplanationModal" class="modal-overlay" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header" style="background: var(--primary);">
                <h2 id="explanationTitle">Chart Info</h2>
                <span class="close-modal close-explanation">&times;</span>
            </div>
            <div class="modal-body" id="explanationBody">
                </div>
        </div>
    </div>

    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="script.js"></script>
</body>
</html>